<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link href="stylesheets/pygments.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="stylesheets/softcover.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="stylesheets/custom.css" media="screen" rel="stylesheet" type="text/css" />
    
    <title>nimdays</title>
    
      <script type="text/x-mathjax-config">
              MathJax.Hub.Config({
        "HTML-CSS": {
          availableFonts: ["TeX"],
        },
        TeX: {
          extensions: ["AMSmath.js", "AMSsymbols.js", "color.js"],
          equationNumbers: {
            autoNumber: "AMS",
            formatNumber: function (n) { return "2" + '.' + n }
          },
          Macros: {
            PolyTeX:    "Poly{\\TeX}",
            PolyTeXnic: "Poly{\\TeX}nic",
            "softcover": "\\texttt{softcover}",
"unitvec": ["{\\hat #1}", 1]
          }
        },
        showProcessingMessages: false,
        messageStyle: "none",
        imageFont: null,
        "AssistiveMML": { disabled: true }
      });

        if (/PhantomJS/.test(window.navigator.userAgent)) {
          MathJax.Hub.Queue([alert, 'MathJax Done']);
        }
      </script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_SVG"></script>
    
  </head>
  <body>
    
    <div id="book">
      <div id="cid4" data-tralics-id="cid4" class="chapter" data-number="2" data-chapter="day2_bencode"><h1><a href="day2_bencode.html#cid4" class="heading hyperref"><span class="number">Chapter 2 </span>Day 2: Parsing Bencode</a></h1>
<p class="noindent">nim-bencode is a library to encode/decode torrent files <a href="https://en.wikipedia.org/wiki/Bencode" target="_blank" rel="noopener">Bencode</a></p>
</div>
<div id="cid5" data-tralics-id="cid5" class="section" data-number="2.1"><h2><a href="day2_bencode.html#cid5" class="heading hyperref"><span class="number">2.1 </span>What to expect?</a></h2>
<p class="noindent"></p><div class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="n">bencode</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">strformat</span>

<span class="k">let</span> <span class="n">encoder</span> <span class="o">=</span> <span class="n">newEncoder</span><span class="p">()</span>
<span class="k">let</span> <span class="n">decoder</span> <span class="o">=</span> <span class="n">newDecoder</span><span class="p">()</span>

<span class="k">let</span> <span class="n">btListSample1</span> <span class="o">=</span> <span class="o">@[</span><span class="n">BencodeType</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span><span class="n">btInt</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="mi">1</span><span class="p">),</span> <span class="n">BencodeType</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span><span class="n">btString</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span><span class="s">"hi"</span><span class="p">)</span> <span class="o">]</span>
<span class="kd">var</span> <span class="n">btDictSample1</span> <span class="o">=</span> <span class="n">initOrderedTable</span><span class="o">[</span><span class="n">BencodeType</span><span class="p">,</span> <span class="n">BencodeType</span><span class="o">]</span><span class="p">()</span>
<span class="n">btDictSample1</span><span class="o">[</span><span class="n">BencodeType</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span><span class="n">btString</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span><span class="s">"name"</span><span class="p">)</span><span class="o">]</span> <span class="o">=</span> <span class="n">BencodeType</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span><span class="n">btString</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span><span class="s">"dmdm"</span><span class="p">)</span>
<span class="n">btDictSample1</span><span class="o">[</span><span class="n">BencodeType</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span><span class="n">btString</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span><span class="s">"lang"</span><span class="p">)</span><span class="o">]</span> <span class="o">=</span> <span class="n">BencodeType</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span><span class="n">btString</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span><span class="s">"nim"</span><span class="p">)</span>
<span class="n">btDictSample1</span><span class="o">[</span><span class="n">BencodeType</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span><span class="n">btString</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span><span class="s">"age"</span><span class="p">)</span><span class="o">]</span> <span class="o">=</span> <span class="n">BencodeType</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span><span class="n">btInt</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="mi">50</span><span class="p">)</span>
<span class="n">btDictSample1</span><span class="o">[</span><span class="n">BencodeType</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span><span class="n">btString</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span><span class="s">"alist"</span><span class="p">)</span><span class="o">]</span> <span class="o">=</span> <span class="n">BencodeType</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span><span class="n">btList</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span><span class="n">btListSample1</span><span class="p">)</span>

<span class="kd">var</span> <span class="n">testObjects</span> <span class="o">=</span> <span class="n">initOrderedTable</span><span class="o">[</span><span class="n">BencodeType</span><span class="p">,</span> <span class="kt">string</span><span class="o">]</span><span class="p">()</span>
<span class="n">testObjects</span><span class="o">[</span><span class="n">BencodeType</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span> <span class="n">btString</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span><span class="s">"hello"</span><span class="p">)</span><span class="o">]</span> <span class="o">=</span> <span class="s">"5:hello"</span>
<span class="n">testObjects</span><span class="o">[</span><span class="n">BencodeType</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span> <span class="n">btString</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span><span class="s">"yes"</span><span class="p">)</span><span class="o">]</span> <span class="o">=</span> <span class="s">"3:yes"</span>
<span class="n">testObjects</span><span class="o">[</span><span class="n">BencodeType</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span> <span class="n">btInt</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="mi">55</span><span class="p">)</span><span class="o">]</span> <span class="o">=</span> <span class="s">"i55e"</span>

<span class="n">testObjects</span><span class="o">[</span><span class="n">BencodeType</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span> <span class="n">btInt</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="mi">12345</span><span class="p">)</span><span class="o">]</span> <span class="o">=</span> <span class="s">"i12345e"</span>
<span class="n">testObjects</span><span class="o">[</span><span class="n">BencodeType</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span> <span class="n">btList</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span><span class="n">btListSample1</span><span class="p">)</span><span class="o">]</span> <span class="o">=</span> <span class="s">"li1e2:hie"</span>
<span class="n">testObjects</span><span class="o">[</span><span class="n">BencodeType</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span><span class="n">btDict</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span><span class="n">btDictSample1</span><span class="p">)</span><span class="o">]</span> <span class="o">=</span> <span class="s">"d4:name4:dmdm4:lang3:nim3:agei50e5:alistli1e2:hiee"</span>


<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">testObjects</span><span class="p">.</span><span class="n">pairs</span><span class="p">():</span>
    <span class="n">echo</span> <span class="o">$</span><span class="n">k</span> <span class="o">&amp;</span> <span class="s">" =&gt; "</span> <span class="o">&amp;</span> <span class="o">$</span><span class="n">v</span>
    <span class="n">doAssert</span><span class="p">(</span><span class="n">encoder</span><span class="p">.</span><span class="n">encodeObject</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">doAssert</span><span class="p">(</span><span class="n">decoder</span><span class="p">.</span><span class="n">decodeObject</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="n">k</span><span class="p">)</span>
</pre></div></div>
</div>
<div id="cid6" data-tralics-id="cid6" class="section" data-number="2.2"><h2><a href="day2_bencode.html#cid6" class="heading hyperref"><span class="number">2.2 </span>Implementation</a></h2>
<p class="noindent">TODO</p>
</div>
    </div>
  </body>
</html>
