<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link href="stylesheets/pygments.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="stylesheets/softcover.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="stylesheets/custom.css" media="screen" rel="stylesheet" type="text/css" />
    
    <title>nimdays</title>
    
      <script type="text/x-mathjax-config">
              MathJax.Hub.Config({
        "HTML-CSS": {
          availableFonts: ["TeX"],
        },
        TeX: {
          extensions: ["AMSmath.js", "AMSsymbols.js", "color.js"],
          equationNumbers: {
            autoNumber: "AMS",
            formatNumber: function (n) { return "11" + '.' + n }
          },
          Macros: {
            PolyTeX:    "Poly{\\TeX}",
            PolyTeXnic: "Poly{\\TeX}nic",
            "softcover": "\\texttt{softcover}",
"unitvec": ["{\\hat #1}", 1]
          }
        },
        showProcessingMessages: false,
        messageStyle: "none",
        imageFont: null,
        "AssistiveMML": { disabled: true }
      });

        if (/PhantomJS/.test(window.navigator.userAgent)) {
          MathJax.Hub.Queue([alert, 'MathJax Done']);
        }
      </script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_SVG"></script>
    
  </head>
  <body>
    
    <div id="book">
      <div id="cid35" data-tralics-id="cid35" class="chapter" data-number="11" data-chapter="day11_buildsystem"><h1><a href="day11_buildsystem.html#cid35" class="heading hyperref"><span class="number">Chapter 11 </span>Day 11 ( Bake applications)</a></h1>
<p class="noindent">I used to work on application 2 years ago, and It was a bit like ansible defining recipes to create applications and managng their dependencies.</p>
</div>
<div id="cid36" data-tralics-id="cid36" class="section" data-number="11.1"><h2><a href="day11_buildsystem.html#cid36" class="heading hyperref"><span class="number">11.1 </span>What to expect</a></h2>
<p class="noindent">Today we will be doing something very simple to track our dependencies and print the bash commands for each task like Makefile.</p>
<div class="code"><div class="highlight"><pre><span></span><span class="nv">HEADERS</span> <span class="o">=</span> program.h headers.h

<span class="nf">default</span><span class="o">:</span> <span class="n">program</span>

<span class="nf">program.o</span><span class="o">:</span> <span class="n">program</span>.<span class="n">c</span> <span class="k">$(</span><span class="nv">HEADERS</span><span class="k">)</span>
    gcc -c program.c -o program.o

<span class="nf">program</span><span class="o">:</span> <span class="n">program</span>.<span class="n">o</span>
    gcc program.o -o program

<span class="nf">clean</span><span class="o">:</span>
    -rm -f program.o
    -rm -f program
</pre></div></div>
<p>Basically, makefile consists of</p>
<ul>
<li>Variables
</li>
<li>Targets
</li>
<li>Dependencies
</li></ul>
<p><code>variables</code> like <code>HEADERS=...</code>, <code>targets</code> whatever precedes the <code>:</code> like <code>clean</code>, <code>program</code>, <code>program.o</code>, <code>dependencies</code> are what a target depends on, so for instance <code>program</code> target that generates the executable requires <code>program.o</code> dependency to be executed first.</p>
</div>
<div id="cid37" data-tralics-id="cid37" class="section" data-number="11.2"><h2><a href="day11_buildsystem.html#cid37" class="heading hyperref"><span class="number">11.2 </span>Example API usage</a></h2>
<div id="uid126" data-tralics-id="uid126" class="subsection" data-number="11.2.1"><h3><a href="day11_buildsystem.html#uid126" class="heading hyperref"><span class="number">11.2.1 </span>Normal usage</a></h3>
<p class="noindent"></p><div class="code"><div class="highlight"><pre><span></span>  <span class="kd">var</span> <span class="n">b</span> <span class="o">=</span> <span class="n">initBake</span><span class="p">()</span>
  <span class="n">b</span><span class="p">.</span><span class="n">add_task</span><span class="p">(</span><span class="s">"publish"</span><span class="p">,</span> <span class="o">@[</span><span class="s">"build-release"</span><span class="o">]</span><span class="p">,</span> <span class="s">"print publish"</span><span class="p">)</span>
  <span class="n">b</span><span class="p">.</span><span class="n">add_task</span><span class="p">(</span><span class="s">"build-release"</span><span class="p">,</span> <span class="o">@[</span><span class="s">"nim-installed"</span><span class="o">]</span><span class="p">,</span> <span class="s">"print exec command to build release mode"</span><span class="p">)</span>
  <span class="n">b</span><span class="p">.</span><span class="n">add_task</span><span class="p">(</span><span class="s">"nim-installed"</span><span class="p">,</span> <span class="o">@[</span><span class="s">"curl-installed"</span><span class="o">]</span><span class="p">,</span> <span class="s">"print curl LINK | bash"</span><span class="p">)</span>
  <span class="n">b</span><span class="p">.</span><span class="n">add_task</span><span class="p">(</span><span class="s">"curl-installed"</span><span class="p">,</span> <span class="o">@[</span><span class="s">"apt-installed"</span><span class="o">]</span><span class="p">,</span> <span class="s">"apt-get install curl"</span><span class="p">)</span>
  <span class="n">b</span><span class="p">.</span><span class="n">add_task</span><span class="p">(</span><span class="s">"apt-installed"</span><span class="p">,</span> <span class="o">@[]</span><span class="p">,</span> <span class="s">"code to install apt..."</span><span class="p">)</span>
  <span class="n">b</span><span class="p">.</span><span class="n">run_task</span><span class="p">(</span><span class="s">"publish"</span><span class="p">)</span>
</pre></div></div>
<p>OUTPUT:</p>
<div class="code"><div class="highlight"><pre><span></span>code to install apt...
apt-get install curl
print curl LINK | bash
print exec command to build release mode
print publish
</pre></div></div>
</div>
<div id="uid127" data-tralics-id="uid127" class="subsection" data-number="11.2.2"><h3><a href="day11_buildsystem.html#uid127" class="heading hyperref"><span class="number">11.2.2 </span>Circular dependencies</a></h3>
<p class="noindent"></p><div class="code"><div class="highlight"><pre><span></span>  <span class="kd">var</span> <span class="n">b</span> <span class="o">=</span> <span class="n">initBake</span><span class="p">()</span>
  <span class="n">b</span><span class="p">.</span><span class="n">add_task</span><span class="p">(</span><span class="s">"publish"</span><span class="p">,</span> <span class="o">@[</span><span class="s">"build-release"</span><span class="o">]</span><span class="p">,</span> <span class="s">"print publish"</span><span class="p">)</span>
  <span class="n">b</span><span class="p">.</span><span class="n">add_task</span><span class="p">(</span><span class="s">"build-release"</span><span class="p">,</span> <span class="o">@[</span><span class="s">"nim-installed"</span><span class="o">]</span><span class="p">,</span> <span class="s">"print exec command to build release mode"</span><span class="p">)</span>
  <span class="n">b</span><span class="p">.</span><span class="n">add_task</span><span class="p">(</span><span class="s">"nim-installed"</span><span class="p">,</span> <span class="o">@[</span><span class="s">"curl-installed"</span><span class="o">]</span><span class="p">,</span> <span class="s">"print curl LINK | bash"</span><span class="p">)</span>
  <span class="n">b</span><span class="p">.</span><span class="n">add_task</span><span class="p">(</span><span class="s">"curl-installed"</span><span class="p">,</span> <span class="o">@[</span><span class="s">"publish"</span><span class="p">,</span> <span class="s">"apt-installed"</span><span class="o">]</span><span class="p">,</span> <span class="s">"apt-get install curl"</span><span class="p">)</span>
  <span class="n">b</span><span class="p">.</span><span class="n">add_task</span><span class="p">(</span><span class="s">"apt-installed"</span><span class="p">,</span> <span class="o">@[]</span><span class="p">,</span> <span class="s">"code to install apt..."</span><span class="p">)</span>
  <span class="n">b</span><span class="p">.</span><span class="n">run_task</span><span class="p">(</span><span class="s">"publish"</span><span class="p">)</span>
</pre></div></div>
<p>Output:
</p><div class="code"><div class="highlight"><pre><span></span>Found cycle please fix:@["build-release", "nim-installed", "curl-installed", "publish", "build-release"]
</pre></div></div>
</div>
<div id="uid128" data-tralics-id="uid128" class="subsection" data-number="11.2.3"><h3><a href="day11_buildsystem.html#uid128" class="heading hyperref"><span class="number">11.2.3 </span>Implementation</a></h3>
<div id="uid129" data-tralics-id="uid129" class="subsubsection" data-number="11.2.3.1"><h4><a href="#uid129" class="heading">Imports</a></h4>
<p class="noindent"></p><div class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="n">strformat</span><span class="p">,</span> <span class="n">strutils</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">sequtils</span><span class="p">,</span> <span class="n">algorithm</span>
</pre></div></div>
</div>
<div id="uid130" data-tralics-id="uid130" class="subsubsection" data-number="11.2.3.2"><h4><a href="#uid130" class="heading">Graphs</a></h4>
<p class="noindent">Graphs are very powerful data structure and used to solve lots of problems, like getting the shortest route and detecting circular dependencies in our code today :)</p>
<p>So How to represent graph?<span class="intersentencespace"></span> Well, we will use <a href="https://en.wikipedia.org/wiki/Adjacency_list" target="_blank" rel="noopener">Adjaceny list</a></p>
</div>
<div id="uid131" data-tralics-id="uid131" class="subsubsection" data-number="11.2.3.3"><h4><a href="#uid131" class="heading">Objects</a></h4>
<p class="noindent"></p><div class="code"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="n">Task</span> <span class="o">=</span> <span class="k">object</span>
  <span class="n">requires</span><span class="o">*</span><span class="p">:</span> <span class="kt">seq</span><span class="o">[</span><span class="kt">string</span><span class="o">]</span>
  <span class="n">actions</span><span class="o">*</span><span class="p">:</span> <span class="kt">string</span>
  <span class="n">name</span><span class="o">*</span><span class="p">:</span> <span class="kt">string</span>

<span class="k">proc </span><span class="nf">`$`</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">Task</span><span class="p">):</span> <span class="kt">string</span> <span class="o">=</span> 
  <span class="k">return</span> <span class="n">fmt</span><span class="p">(</span><span class="s">"Task {this.name} Requirements: {this.requires} , actions {this.actions}"</span><span class="p">)</span>
</pre></div></div>
<p>Task object represnts a <code>target</code> in makefile language, and it has a name, actions code and list of dependencies</p>
<div class="code"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="n">Bake</span> <span class="o">=</span> <span class="k">ref</span> <span class="k">object</span>
  <span class="n">tasksgraph</span><span class="o">*</span> <span class="p">:</span> <span class="n">Table</span><span class="o">[</span><span class="kt">string</span><span class="p">,</span> <span class="kt">seq</span><span class="o">[</span><span class="kt">string</span><span class="o">]]</span>
  <span class="n">tasks</span><span class="o">*</span>      <span class="p">:</span> <span class="n">Table</span><span class="o">[</span><span class="kt">string</span><span class="p">,</span> <span class="n">Task</span><span class="o">]</span>
</pre></div></div>
<p>Bake object has <code>tasksgraph</code> adjaceny list representing the tasks and their dependencies and tasks table that maps taskname to task object</p>
</div>
<div id="uid132" data-tralics-id="uid132" class="subsubsection" data-number="11.2.3.4"><h4><a href="#uid132" class="heading">Adding a task</a></h4>
<p class="noindent"></p><div class="code"><div class="highlight"><pre><span></span><span class="k">proc </span><span class="nf">addTask</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">Bake</span><span class="p">,</span> <span class="n">taskname</span><span class="p">:</span> <span class="kt">string</span><span class="p">,</span> <span class="n">deps</span><span class="p">:</span> <span class="kt">seq</span><span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="p">,</span> <span class="n">actions</span><span class="p">:</span><span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="n">void</span> <span class="o">=</span> 
  <span class="kd">var</span> <span class="n">t</span> <span class="o">=</span>  <span class="n">Task</span><span class="p">(</span><span class="n">name</span><span class="p">:</span><span class="n">taskname</span><span class="p">,</span> <span class="n">requires</span><span class="p">:</span><span class="n">deps</span><span class="p">,</span> <span class="n">actions</span><span class="p">:</span><span class="n">actions</span><span class="p">)</span>
  <span class="n">this</span><span class="p">.</span><span class="n">tasksgraph</span><span class="o">[</span><span class="n">taskname</span><span class="o">]</span> <span class="o">=</span> <span class="n">deps</span>
  <span class="n">this</span><span class="p">.</span><span class="n">tasks</span><span class="o">[</span><span class="n">taskname</span><span class="o">]</span> <span class="o">=</span> <span class="n">t</span>
</pre></div></div>
<p>- We update the adjacency list with (taskname and its dependencies)
- Add task object to tasks Table with key task name</p>
</div>
<div id="uid133" data-tralics-id="uid133" class="subsubsection" data-number="11.2.3.5"><h4><a href="#uid133" class="heading">Running tasks</a></h4>
<p class="noindent"></p><div class="code"><div class="highlight"><pre><span></span><span class="k">proc </span><span class="nf">runTask</span><span class="o">*</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">Bake</span><span class="p">,</span> <span class="n">taskname</span><span class="p">:</span> <span class="kt">string</span><span class="p">):</span> <span class="n">void</span> <span class="o">=</span>
  <span class="c"># CODE OMITTED FOR FINIDNG CYCLES..</span>

  <span class="kd">var</span> <span class="n">deps</span> <span class="o">=</span> <span class="n">newSeq</span><span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="p">()</span>
  <span class="kd">var</span> <span class="n">seen</span> <span class="o">=</span> <span class="n">newSeq</span><span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="p">()</span>

  <span class="n">this</span><span class="p">.</span><span class="n">runTaskHelper</span><span class="p">(</span><span class="n">taskname</span><span class="p">,</span> <span class="n">deps</span><span class="p">,</span> <span class="n">seen</span><span class="p">)</span>      

  <span class="k">for</span> <span class="n">tsk</span> <span class="ow">in</span> <span class="n">deps</span><span class="p">:</span>
      <span class="k">let</span> <span class="n">t</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">tasks</span><span class="p">.</span><span class="n">getOrDefault</span><span class="p">(</span><span class="n">tsk</span><span class="p">)</span>
      <span class="n">echo</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">actions</span><span class="p">)</span>
</pre></div></div>
<p>- Before running a task we should check if it has a cycle first.<span class="intersentencespace"></span> - Keep track of dependencies and the seen tasks so far so we don’t <code>run seen tasks</code> again.<span class="intersentencespace"></span> (for instance if we have target install-wget and target install-curl and both require target <code>apt-get update</code>, so we want to run <code>apt-get update</code> only once )</p>
<p>for example
</p><div class="code"><div class="highlight"><pre><span></span>code to install apt...
apt-get install curl
print curl LINK | bash
print exec command to build release mode
print publish
</pre></div></div>
<ul>
<li>Call <code>runTaskHelper</code> procedure to walk through all the <code>tasks</code> and their <code>dependencies</code> and get us a list of deps <code>each will update deps variable as we will be sending it by reference</code>
</li>
<li>After getting correct dependencies tasks sorted we execute <code>in our case we will just echo actions property</code>
</li></ul>
<p>and now to <code>runTaskHelper</code> that basically updates our dependencies list and put the task execution in order</p>
<div class="code"><div class="highlight"><pre><span></span><span class="k">proc </span><span class="nf">runTaskHelper</span><span class="p">(</span><span class="n">this</span><span class="p">:</span> <span class="n">Bake</span><span class="p">,</span> <span class="n">taskname</span><span class="p">:</span> <span class="kt">string</span><span class="p">,</span> <span class="n">deps</span><span class="p">:</span> <span class="kd">var</span> <span class="kt">seq</span><span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="p">,</span> <span class="n">seen</span><span class="p">:</span> <span class="kd">var</span> <span class="kt">seq</span><span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="p">)</span> <span class="p">:</span> <span class="n">void</span> <span class="o">=</span> 
  <span class="k">if</span> <span class="n">taskname</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
    <span class="n">echo</span> <span class="s">"[+] Solved {taskname} before no need to repeat action"</span>
  <span class="kd">var</span> <span class="n">tsk</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">tasks</span><span class="p">.</span><span class="n">getOrDefault</span><span class="p">(</span><span class="n">taskname</span><span class="p">)</span>

  <span class="n">seen</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">taskname</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">len</span><span class="p">(</span><span class="n">tsk</span><span class="p">.</span><span class="n">requires</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">this</span><span class="p">.</span><span class="n">tasksgraph</span><span class="o">[</span><span class="n">tsk</span><span class="p">.</span><span class="n">name</span><span class="o">]</span><span class="p">:</span>
      <span class="n">this</span><span class="p">.</span><span class="n">runTaskHelper</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">deps</span><span class="p">,</span> <span class="n">seen</span><span class="p">)</span>
  <span class="n">deps</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">taskname</span><span class="p">)</span>
</pre></div></div>
</div>
<div id="uid136" data-tralics-id="uid136" class="subsubsection" data-number="11.2.3.6"><h4><a href="#uid136" class="heading">Detecting cycles</a></h4>
<p class="noindent">To detect a cycle we use <code>DFS</code> depth first search algorithm basically going from one node as deep as we can go for each of its neigbours and <code>Graph coloring</code>.<span class="intersentencespace"></span> <a href="https://www.youtube.com/watch?v=rKQaZuoUR4M" target="_blank" rel="noopener">Youtube Lecture</a></p>
<p>Explanation from geeksforgeeks
</p><div class="code"><div class="highlight"><pre><span></span>    WHITE : Vertex is not processed yet.  Initially
            all vertices are WHITE.

    GRAY : Vertex is being processed (DFS for this 
        vertex has started, but not finished which means
        that all descendants (ind DFS tree) of this vertex
        are not processed yet (or this vertex is in function
        call stack)

    BLACK : Vertex and all its descendants are 
            processed.

    While doing DFS, if we encounter an edge from current 
    vertex to a GRAY vertex, then this edge is back edge 
    and hence there is a cycle.
</pre></div></div>
<p>OK, back to nim</p>
<p>1- Defining colors</p>
<div class="code"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="n">NodeColor</span> <span class="o">=</span> <span class="k">enum</span>
  <span class="n">ncWhite</span><span class="p">,</span> <span class="n">ncGray</span><span class="p">,</span> <span class="n">ncBlack</span>
</pre></div></div>
<p>2- Graph has Cycle
</p><div class="code"><div class="highlight"><pre><span></span><span class="k">proc </span><span class="nf">graphHasCycle</span><span class="p">(</span><span class="n">graph</span><span class="p">:</span> <span class="n">Table</span><span class="o">[</span><span class="kt">string</span><span class="p">,</span> <span class="kt">seq</span><span class="o">[</span><span class="kt">string</span><span class="o">]]</span><span class="p">):</span> <span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">Table</span><span class="o">[</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="o">]</span><span class="p">)</span> <span class="o">=</span>
  <span class="kd">var</span> <span class="n">colors</span> <span class="o">=</span> <span class="n">initTable</span><span class="o">[</span><span class="kt">string</span><span class="p">,</span> <span class="n">NodeColor</span><span class="o">]</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">deps</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
    <span class="n">colors</span><span class="o">[</span><span class="n">node</span><span class="o">]</span> <span class="o">=</span> <span class="n">ncWhite</span>
  
  <span class="kd">var</span> <span class="n">parentMap</span> <span class="o">=</span> <span class="n">initTable</span><span class="o">[</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="o">]</span><span class="p">()</span>
  <span class="kd">var</span> <span class="n">hasCycle</span> <span class="o">=</span> <span class="kp">false</span> 
  <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">deps</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
    <span class="n">parentMap</span><span class="o">[</span><span class="n">node</span><span class="o">]</span> <span class="o">=</span> <span class="s">"null"</span>
    <span class="k">if</span> <span class="n">colors</span><span class="o">[</span><span class="n">node</span><span class="o">]</span> <span class="o">==</span> <span class="n">ncWhite</span><span class="p">:</span>
      <span class="n">hasCycleDFS</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">hasCycle</span><span class="p">,</span> <span class="n">parentMap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hasCycle</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">(</span><span class="kp">true</span><span class="p">,</span> <span class="n">parentMap</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span><span class="kp">false</span><span class="p">,</span> <span class="n">parentMap</span><span class="p">)</span>
</pre></div></div>
<p>3- Depth First Function</p>
<div class="code"><div class="highlight"><pre><span></span><span class="k">proc </span><span class="nf">hasCycleDFS</span><span class="p">(</span><span class="n">graph</span><span class="p">:</span><span class="n">Table</span><span class="o">[</span><span class="kt">string</span><span class="p">,</span> <span class="kt">seq</span><span class="o">[</span><span class="kt">string</span><span class="o">]]</span> <span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="kt">string</span><span class="p">,</span> <span class="n">colors</span><span class="p">:</span> <span class="kd">var</span> <span class="n">Table</span><span class="o">[</span><span class="kt">string</span><span class="p">,</span> <span class="n">NodeColor</span><span class="o">]</span><span class="p">,</span> <span class="n">has_cycle</span><span class="p">:</span> <span class="kd">var</span> <span class="kt">bool</span><span class="p">,</span> <span class="n">parentMap</span><span class="p">:</span> <span class="kd">var</span> <span class="n">Table</span><span class="o">[</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="o">]</span><span class="p">)</span> <span class="o">=</span>
  <span class="k">if</span> <span class="n">hasCycle</span><span class="p">:</span>
      <span class="k">return</span>
  <span class="n">colors</span><span class="o">[</span><span class="n">node</span><span class="o">]</span> <span class="o">=</span> <span class="n">ncGray</span> 

  <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">[</span><span class="n">node</span><span class="o">]</span><span class="p">:</span>
    <span class="n">parentMap</span><span class="o">[</span><span class="n">dep</span><span class="o">]</span> <span class="o">=</span> <span class="n">node</span>
    <span class="k">if</span> <span class="n">colors</span><span class="o">[</span><span class="n">dep</span><span class="o">]</span> <span class="o">==</span> <span class="n">ncGray</span><span class="p">:</span>
      <span class="n">hasCycle</span> <span class="o">=</span> <span class="kp">true</span>   
      <span class="n">parentMap</span><span class="o">[</span><span class="s">"__CYCLESTART__"</span><span class="o">]</span> <span class="o">=</span> <span class="n">dep</span>
      <span class="k">return</span>
    <span class="k">if</span> <span class="n">colors</span><span class="o">[</span><span class="n">dep</span><span class="o">]</span> <span class="o">==</span> <span class="n">ncWhite</span><span class="p">:</span>  
      <span class="n">hasCycleDFS</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">hasCycle</span><span class="p">,</span> <span class="n">parentMap</span><span class="p">)</span>
  <span class="n">colors</span><span class="o">[</span><span class="n">node</span><span class="o">]</span> <span class="o">=</span> <span class="n">ncBlack</span>  
</pre></div></div>
</div></div>
<div id="uid137" data-tralics-id="uid137" class="subsection" data-number="11.2.4"><h3><a href="day11_buildsystem.html#uid137" class="heading hyperref"><span class="number">11.2.4 </span>What’s next?</a></h3>
<ul>
<li>support for variables
</li>
<li>recipes maybe using yaml file
</li>
<li>modules like ansible?<span class="intersentencespace"></span>
</li></ul>
</div></div>
    </div>
  </body>
</html>
